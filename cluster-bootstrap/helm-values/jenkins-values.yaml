controller:
  additionalPlugins:
  - job-dsl:1.93
  # ref: https://github.com/jenkinsci/configuration-as-code-plugin/blob/master/docs/features/secrets.adoc#kubernetes-secrets
  additionalExistingSecrets:
   - name: github-auth-ssh-key
     keyName: ssh-private-key
  
  JCasC:
    enabled: true
    authorizationStrategy: unsecured
    configScripts:
     disable-ssh-host-verification-control: |
        security:
          gitHostKeyVerificationConfiguration:
            sshHostKeyVerificationStrategy: "noHostKeyVerificationStrategy"
     create-github-ssh-credential: |
        credentials:
          system:
            domainCredentials:
              - credentials:
                  - basicSSHUserPrivateKey:
                      scope: GLOBAL
                      id: "github-ssh-private-key"
                      username: "git"
                      description: "github private ssh key"
                      privateKeySource:
                        directEntry:
                          privateKey: ${github-auth-ssh-key-ssh-private-key}
     create-pipeline-job: |
        jobs:
          - script: >
              pipelineJob('app-job') {
                  description('this job was created by job-dsl plugin which was invoked by jcasc')
                  definition { 
                      cpsScm { 
                        scm {
                          git {
                            remote {
                                url('git@github.com:cemanaral/test-kubernetes-app.git')
                                credentials('github-ssh-private-key')
                            }
                            extensions {
                                cleanAfterCheckout()
                            }
                          }
                        }                    
                      }
                  }
                  triggers {
                      scm('* * * * *') 
                  }
              }


agent:
  podTemplates: 
    docker-build: |
      - name: docker-build
        label: docker-build
        serviceAccount: jenkins
        runAsGroup: 999
        runAsUser: 1000
        containers:
          - name: docker-build
            image: docker:28.2.2-dind-rootless
            args: "-c 'sleep 9000'"
            command: "/bin/sh"
        volumes:
        - hostPathVolume: 
            hostPath: /var/run/docker.sock
            mountPath: /var/run/docker.sock
